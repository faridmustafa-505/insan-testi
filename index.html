<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Bas Qazan</title>
    <script>
        if (window.location.hostname.includes("onrender.com")) {
            window.location.replace("https://basqazan.click");
        }
    </script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            user-select: none;
            -webkit-user-select: none;
        }

        body {
            background-color: #f0f2f5;
            display: flex;
            flex-direction: column;
            height: 100vh; 
            height: 100dvh; 
            overflow: hidden;
        }

        .topbar {
            background-color: #ffffff;
            padding: 15px 25px;
            z-index: 10;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
            padding-top: calc(15px + env(safe-area-inset-top));
            border-bottom: 1px solid #eee;
        }

        .balance-label { 
            font-size: 16px; 
            font-weight: 600;
            color: #555; 
        }
        
        .balance-amount { 
            font-size: 22px; 
            font-weight: 800; 
            color: #27ae60; 
        }

        .stats-container {
            background-color: #ffffff;
            padding: 12px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            margin-bottom: 10px;
            position: relative;
            z-index: 9;
        }

        .stat-box {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .stat-icon-bg {
            width: 40px;
            height: 40px;
            border-radius: 12px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 20px;
        }

        .users-icon { background-color: #e3f2fd; color: #1976d2; }
        .money-icon { background-color: #e8f5e9; color: #2e7d32; }

        .stat-info {
            display: flex;
            flex-direction: column;
        }

        .stat-value {
            font-size: 16px;
            font-weight: 800;
            color: #333;
        }

        .stat-title {
            font-size: 11px;
            color: #888;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .game-area {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            overflow-y: auto;
            padding: 10px;
        }

        .click-btn {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            border: none;
            background: radial-gradient(circle, #3498db 0%, #2980b9 100%);
            color: white;
            font-size: 22px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 10px 25px rgba(41, 128, 185, 0.4);
            transition: transform 0.1s, background 0.3s;
            outline: none;
            -webkit-tap-highlight-color: transparent;
            margin-bottom: 10px;
        }

        .click-btn:active { transform: scale(0.95); }
        
        /* Deaktiv dÃ¼ymÉ™ stili */
        .click-btn:disabled {
            background: #95a5a6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .tap-hint {
            margin-top: 20px;
            color: #888;
            font-size: 14px;
            animation: pulse 2s infinite;
        }

        .footer {
            padding: 20px;
            background: white;
            text-align: center;
            flex-shrink: 0;
            padding-bottom: calc(20px + env(safe-area-inset-bottom));
            box-shadow: 0 -5px 20px rgba(0,0,0,0.05);
        }

        .withdraw-btn {
            width: 100%;
            max-width: 400px;
            padding: 16px;
            background-color: #bdc3c7;
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: bold;
            cursor: not-allowed;
            transition: background 0.3s;
        }

        .withdraw-btn.active {
            background-color: #27ae60;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(39, 174, 96, 0.3);
        }
        .withdraw-btn.active:active { transform: translateY(2px); }

        .modal-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 100;
            justify-content: center; align-items: center;
            padding: 20px;
        }

        .modal {
            background: white;
            padding: 25px;
            border-radius: 20px;
            text-align: center;
            max-width: 350px;
            width: 100%;
        }
        
        .progress-bar {
            height: 8px; background: #eee; border-radius: 4px;
            margin: 15px 0; overflow: hidden;
        }
        .progress-fill { height: 100%; width: 0%; background: #f39c12; transition: width 0.3s; }
        
        .share-buttons-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 15px;
        }

        .share-btn {
            color: white; padding: 12px;
            border: none; border-radius: 8px; width: 100%; 
            font-weight: bold; cursor: pointer;
            display: flex; justify-content: center; align-items: center; gap: 8px;
            font-size: 15px;
        }

        .btn-whatsapp { background-color: #25D366; }
        
        .btn-youtube {
            background-color: #FF0000;
            margin-bottom: 10px;
        }
        
        .btn-whatsapp:active, .btn-youtube:active { opacity: 0.8; transform: scale(0.98); }

        @keyframes pulse { 0% {opacity: 0.6;} 50% {opacity: 1;} 100% {opacity: 0.6;} }

        /* --- CHAT STYLES --- */
        .chat-toggle-btn {
            position: fixed;
            bottom: 90px;
            right: 20px;
            width: 60px;
            height: 60px;
            background-color: #3498db;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 28px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            z-index: 90;
            cursor: pointer;
            border: none;
            transition: transform 0.2s;
        }
        .chat-toggle-btn:active { transform: scale(0.9); }

        .chat-container {
            display: none;
            position: fixed;
            bottom: 100px;
            right: 20px;
            width: 300px;
            height: 400px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 25px rgba(0,0,0,0.2);
            z-index: 91;
            flex-direction: column;
            overflow: hidden;
        }

        .chat-header {
            background: #3498db;
            color: white;
            padding: 10px 15px;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chat-messages {
            flex: 1;
            padding: 10px;
            overflow-y: auto;
            background: #f9f9f9;
            font-size: 14px;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .message-bubble {
            background: #eee;
            padding: 8px 12px;
            border-radius: 10px;
            max-width: 85%;
        }
        .message-bubble.mine {
            background: #d1f2eb;
            align-self: flex-end;
            border-bottom-right-radius: 2px;
        }
        .message-author {
            font-size: 10px;
            color: #777;
            margin-bottom: 2px;
            font-weight: bold;
        }
        .message-time {
            font-size: 9px;
            color: #999;
            text-align: right;
            margin-top: 2px;
        }

        .chat-input-wrapper {
            padding: 10px;
            border-top: 1px solid #eee;
            display: flex;
            gap: 5px;
        }

        .chat-input {
            flex: 1;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
            outline: none;
        }

        .chat-send-btn {
            padding: 0 15px;
            background: #2ecc71;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

    </style>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
</head>
<body>

    <div class="topbar">
        <div class="balance-label">Sizin Balans</div>
        <div class="balance-amount" id="balanceDisplay">1.00 â‚¼</div>
    </div>

    <div class="stats-container">
        <div class="stat-box">
            <div class="stat-icon-bg users-icon">ðŸ‘¥</div>
            <div class="stat-info">
                <div class="stat-value" id="displayUserCount">0</div>
                <div class="stat-title">Ä°stifadÉ™Ã§i</div>
            </div>
        </div>

        <div class="stat-box">
            <div class="stat-icon-bg money-icon">ðŸ’¸</div>
            <div class="stat-info">
                <div class="stat-value" id="displayPaidAmount">0 â‚¼</div>
                <div class="stat-title">Ã–dÉ™nilib</div>
            </div>
        </div>
    </div>

    <div class="game-area">
        <button class="click-btn" id="clickBtn" onclick="handleClick()">QAZAN <br> (+0.05â‚¼)</button>
        <div class="tap-hint" id="tapHint">Pulu artÄ±rmaq Ã¼Ã§Ã¼n dÃ¼ymÉ™yÉ™ bas</div>
    </div>

    <button class="chat-toggle-btn" onclick="toggleChat()">ðŸ’¬</button>

    <div class="chat-container" id="chatContainer">
        <div class="chat-header">
            <span>CanlÄ± Ã‡at</span>
            <span style="cursor:pointer" onclick="toggleChat()">âœ–</span>
        </div>
        <div class="chat-messages" id="chatMessages">
            </div>
        <div class="chat-input-wrapper">
            <input type="text" class="chat-input" id="chatInput" placeholder="Mesaj yaz...">
            <button class="chat-send-btn" onclick="sendChatMessage()">></button>
        </div>
    </div>

    <div class="footer">
        <button class="withdraw-btn" id="withdrawBtn" onclick="openWithdrawModal()">
            BalansÄ± Ã§Ä±xarmaq Ã¼Ã§Ã¼n 5â‚¼ toplayÄ±n ðŸ”’
        </button>
    </div>

    <div class="modal-overlay" id="modalOverlay">
        <div class="modal">
            <h2>TÉ™brik edirik! ðŸŽ‰</h2>
            <p>Ã‡Ä±xarÄ±ÅŸÄ±n tÉ™sdiqlÉ™nmÉ™si Ã¼Ã§Ã¼n son addÄ±m: <br>SaytÄ± <b>20 dostunla</b> paylaÅŸ. SÉ™hv paylaÅŸÄ±m olunarsa blok olunacaqsÄ±nÄ±z!</p>
            
            <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
            <p id="shareStatus">0 / 20 PaylaÅŸÄ±ldÄ±</p>

            <div class="share-buttons-container">
                <button class="share-btn btn-youtube" onclick="openYoutube()">
                    Youtube KanalÄ±na AbunÉ™ Ol
                </button>

                <button class="share-btn btn-whatsapp" onclick="shareTo('whatsapp')">
                    WhatsApp-da PaylaÅŸ
                </button>
            </div>
            
            <br>
            <button onclick="closeModal()" style="background:none; border:none; color:#999; margin-top:10px;">BaÄŸla</button>
        </div>
    </div>

    <script>
        const manualUsers = 4550; 
        const manualPaid   = 2000; 

        function renderStats() {
            document.getElementById('displayUserCount').innerText = manualUsers.toLocaleString('az-AZ');
            document.getElementById('displayPaidAmount').innerText = manualPaid.toLocaleString('az-AZ') + " â‚¼";
        }

        const firebaseConfig = {
            apiKey: "AIzaSyB0IN8e5jbjXYj7Qw6gDqOZNM4G0CMcNw0",
            authDomain: "insan-testi.firebaseapp.com",
            databaseURL: "https://insan-testi-default-rtdb.firebaseio.com",
            projectId: "insan-testi",
            storageBucket: "insan-testi.firebasestorage.app",
            messagingSenderId: "168416057662",
            appId: "1:168416057662:web:cb3c1e18318d6e27a0746f"
        };

        let db;
        try {
            firebase.initializeApp(firebaseConfig);
            db = firebase.database();
        } catch (e) {
            console.error("Firebase XÉ™tasÄ±:", e);
        }

        let localBalance = parseFloat(localStorage.getItem('userBalance')) || 1.00;
        let shareCount = parseInt(localStorage.getItem('shareCount')) || 0;
        
        const balanceDisplay = document.getElementById('balanceDisplay');
        const withdrawBtn = document.getElementById('withdrawBtn');
        const clickBtn = document.getElementById('clickBtn');
        const tapHint = document.getElementById('tapHint');
        const modalOverlay = document.getElementById('modalOverlay');
        const shareStatus = document.getElementById('shareStatus');
        const progressFill = document.getElementById('progressFill');

        // Chat Variables
        const chatContainer = document.getElementById('chatContainer');
        const chatMessages = document.getElementById('chatMessages');
        const chatInput = document.getElementById('chatInput');
        let chatName = localStorage.getItem('chatName');

        // Random Ad GenerasiyasÄ± (ÆGÆR YOXDURSA)
        if (!chatName) {
            // 100000 ilÉ™ 999999 arasÄ±nda random rÉ™qÉ™m
            const randomNum = Math.floor(100000 + Math.random() * 900000);
            chatName = "user" + randomNum;
            localStorage.setItem('chatName', chatName);
        }

        const shareText = "SadÉ™cÉ™ ekrana basaraq pul qazanÄ±ram. BalansÄ±m 5â‚¼ oldu. SÉ™n dÉ™ yoxla, link burdadÄ±r ðŸ‘‡";
        const shareUrl = "https://basqazan.click";
        const youtubeUrl = "https://www.youtube.com/channel/UCzjaf1aSpkvY6hlXrfsWbwg";

        window.onload = function() {
            renderStats(); 
            updateUI();
            checkVisit();
            initChat(); 
        };

        function checkVisit() {
            if (!localStorage.getItem('hasVisited')) {
                localStorage.setItem('hasVisited', 'true');
                if(db) {
                    db.ref('stats/user_count').transaction((val) => (val || 0) + 1);
                }
            }
        }

        function handleClick() {
            if (localBalance >= 5.00) return; // ÆlavÉ™ qoruma

            localBalance += 0.05;
            localStorage.setItem('userBalance', localBalance.toFixed(2));
            
            if(db) {
                db.ref('stats/global_clicks').transaction((val) => (val || 0) + 1);
            }
            updateUI();
        }

        function updateUI() {
            balanceDisplay.textContent = localBalance.toFixed(2) + " â‚¼";

            if (localBalance >= 5.00) {
                // Pul Ã§Ä±xar aktiv oldu
                withdrawBtn.textContent = "Pulu Ã‡Ä±xar ðŸ’³";
                withdrawBtn.classList.add('active');
                withdrawBtn.disabled = false;
                
                // Oyunu dondur
                clickBtn.disabled = true;
                clickBtn.innerText = "HÉ™dÉ™fÉ™\nÃ‡atdÄ±nÄ±z! ðŸ";
                clickBtn.style.background = "#7f8c8d"; // Boz rÉ™ng
                tapHint.innerText = "BalansÄ± Ã§Ä±xarmaq Ã¼Ã§Ã¼n aÅŸaÄŸÄ±dakÄ± dÃ¼ymÉ™yÉ™ basÄ±n";
                
            } else {
                let diff = (5.00 - localBalance).toFixed(2);
                withdrawBtn.textContent = `BalansÄ± Ã§Ä±xarmaq Ã¼Ã§Ã¼n daha ${diff}â‚¼ toplayÄ±n`;
                withdrawBtn.classList.remove('active');
                withdrawBtn.disabled = true;
                
                clickBtn.disabled = false;
            }
        }

        function openWithdrawModal() {
            if (localBalance >= 5.00) {
                modalOverlay.style.display = "flex";
                updateShareUI();
            }
        }

        function closeModal() {
            modalOverlay.style.display = "none";
        }

        function openYoutube() {
            window.open(youtubeUrl, '_blank');
        }

        function shareTo(platform) {
            let finalLink = "";
            const encodedText = encodeURIComponent(shareText);
            const encodedUrl = encodeURIComponent(shareUrl);

            if (platform === 'whatsapp') {
                finalLink = `https://api.whatsapp.com/send?text=${encodedText}%0A${encodedUrl}`;
            }

            if (finalLink) {
                window.open(finalLink, '_blank');
                incrementShare();
            }
        }

        function incrementShare() {
            if (shareCount < 20) {
                shareCount++;
                localStorage.setItem('shareCount', shareCount);
                updateShareUI();

                if (shareCount === 20) {
                    setTimeout(() => {
                        alert("SorÄŸunuz uÄŸurla qeydÉ™ alÄ±ndÄ±!");
                    }, 1000);
                }
            }
        }

        function updateShareUI() {
            let percentage = (shareCount / 20) * 100;
            progressFill.style.width = percentage + "%";
            shareStatus.textContent = `${shareCount} / 20 PaylaÅŸÄ±ldÄ±`;
            
            if (shareCount >= 20) {
                document.querySelectorAll('.share-btn').forEach(btn => {
                    btn.textContent = "TÉ™sdiqlÉ™ndi âœ… ZÉ™hmÉ™t olmasa bir qÉ™dÉ™r gÃ¶zlÉ™yin. 24 saata qÉ™dÉ™r uzana bilÉ™r! Aktiv olmaÄŸa davam edin! Ã‡atda insanlarla danÄ±ÅŸa bilÉ™rsiniz!";
                    btn.style.opacity = "0.5";
                    btn.disabled = true;
                });
            }
        }

        // --- CHAT FUNCTIONS ---

        function toggleChat() {
            if (chatContainer.style.display === "flex") {
                chatContainer.style.display = "none";
            } else {
                chatContainer.style.display = "flex";
                // ArtÄ±q ad yoxlanÄ±ÅŸÄ± burda lazÄ±m deyil, yÃ¼klÉ™nÉ™ndÉ™ yoxlanÄ±lÄ±r
                scrollToBottom();
            }
        }

        function sendChatMessage() {
            const msg = chatInput.value.trim();
            if (msg.length > 0 && chatName) {
                if (db) {
                    // Mesaj nÃ¶mrÉ™sini (ID) artÄ±rÄ±r
                    db.ref('stats/last_message_id').transaction((currentId) => {
                        return (currentId || 0) + 1;
                    }, (error, committed, snapshot) => {
                        if (committed) {
                            const newId = snapshot.val();
                            // Yeni ID ilÉ™ mesajÄ± yazÄ±r (1, 2, 3...)
                            db.ref('messages/' + newId).set({
                                nickname: chatName,
                                message: msg,
                                timestamp: Date.now()
                            });
                            chatInput.value = "";
                        }
                    });
                }
            }
        }

        function initChat() {
            if (db) {
                // Son 50 mesajÄ± yÃ¼klÉ™
                db.ref('messages').limitToLast(50).on('child_added', (snapshot) => {
                    const data = snapshot.val();
                    if(data) {
                        renderMessage(data);
                    }
                });
            }
        }

        function renderMessage(data) {
            const div = document.createElement('div');
            const isMine = data.nickname === chatName;
            
            // VaxtÄ± formatla (HH:MM)
            const date = new Date(data.timestamp);
            const hours = date.getHours().toString().padStart(2, '0');
            const minutes = date.getMinutes().toString().padStart(2, '0');
            const timeString = `${hours}:${minutes}`;

            div.className = `message-bubble ${isMine ? 'mine' : ''}`;
            div.innerHTML = `
                <div class="message-author">${escapeHtml(data.nickname)}</div>
                ${escapeHtml(data.message)}
                <div class="message-time">${timeString}</div>
            `;
            
            chatMessages.appendChild(div);
            scrollToBottom();
        }

        function scrollToBottom() {
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function escapeHtml(text) {
            if (!text) return "";
            return text
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }
    </script>
</body>
</html>
