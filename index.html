<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Bas Qazan</title>
    <style>
        /* --- Dƒ∞ZAYN (CSS) --- */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            user-select: none;
            -webkit-user-select: none;
        }

        body {
            background-color: #f0f2f5;
            display: flex;
            flex-direction: column;
            height: 100vh; 
            height: 100dvh; 
            overflow: hidden;
        }

        /* Topbar */
        .topbar {
            background-color: #ffffff;
            padding: 15px 25px;
            z-index: 10;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
            padding-top: calc(15px + env(safe-area-inset-top));
            border-bottom: 1px solid #eee;
        }

        .balance-label { 
            font-size: 16px; 
            font-weight: 600;
            color: #555; 
        }
        
        .balance-amount { 
            font-size: 22px; 
            font-weight: 800; 
            color: #27ae60; 
        }

        /* --- YENƒ∞ STATƒ∞STƒ∞KA Hƒ∞SS∆èSƒ∞ --- */
        .stats-container {
            background-color: #ffffff;
            padding: 12px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            margin-bottom: 10px;
            position: relative;
            z-index: 9;
        }

        .stat-box {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .stat-icon-bg {
            width: 40px;
            height: 40px;
            border-radius: 12px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 20px;
        }

        /* ƒ∞kon r…ôngl…ôri */
        .users-icon { background-color: #e3f2fd; color: #1976d2; }
        .money-icon { background-color: #e8f5e9; color: #2e7d32; }

        .stat-info {
            display: flex;
            flex-direction: column;
        }

        .stat-value {
            font-size: 16px;
            font-weight: 800;
            color: #333;
        }

        .stat-title {
            font-size: 11px;
            color: #888;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Orta Hiss…ô */
        .game-area {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            overflow-y: auto;
            padding: 10px;
        }

        .click-btn {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            border: none;
            background: radial-gradient(circle, #3498db 0%, #2980b9 100%);
            color: white;
            font-size: 22px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 10px 25px rgba(41, 128, 185, 0.4);
            transition: transform 0.1s;
            outline: none;
            -webkit-tap-highlight-color: transparent;
            margin-bottom: 10px;
        }

        .click-btn:active { transform: scale(0.95); }

        .tap-hint {
            margin-top: 20px;
            color: #888;
            font-size: 14px;
            animation: pulse 2s infinite;
        }

        /* Footer */
        .footer {
            padding: 20px;
            background: white;
            text-align: center;
            flex-shrink: 0;
            padding-bottom: calc(20px + env(safe-area-inset-bottom));
            box-shadow: 0 -5px 20px rgba(0,0,0,0.05);
        }

        .withdraw-btn {
            width: 100%;
            max-width: 400px;
            padding: 16px;
            background-color: #bdc3c7;
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: bold;
            cursor: not-allowed;
            transition: background 0.3s;
        }

        .withdraw-btn.active {
            background-color: #27ae60;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(39, 174, 96, 0.3);
        }
        .withdraw-btn.active:active { transform: translateY(2px); }

        /* Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 100;
            justify-content: center; align-items: center;
            padding: 20px;
        }

        .modal {
            background: white;
            padding: 25px;
            border-radius: 20px;
            text-align: center;
            max-width: 350px;
            width: 100%;
        }
        
        .progress-bar {
            height: 8px; background: #eee; border-radius: 4px;
            margin: 15px 0; overflow: hidden;
        }
        .progress-fill { height: 100%; width: 0%; background: #f39c12; transition: width 0.3s; }
        
        /* Payla≈üƒ±m D√ºym…ôl…ôri */
        .share-buttons-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 15px;
        }

        .share-btn {
            color: white; padding: 12px;
            border: none; border-radius: 8px; width: 100%; 
            font-weight: bold; cursor: pointer;
            display: flex; justify-content: center; align-items: center; gap: 8px;
            font-size: 15px;
        }

        .btn-whatsapp { background-color: #25D366; }
        .btn-telegram { background-color: #0088cc; }
        
        .btn-whatsapp:active, .btn-telegram:active { opacity: 0.8; transform: scale(0.98); }

        @keyframes pulse { 0% {opacity: 0.6;} 50% {opacity: 1;} 100% {opacity: 0.6;} }
    </style>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
</head>
<body>

    <div class="topbar">
        <div class="balance-label">Sizin Balans</div>
        <div class="balance-amount" id="balanceDisplay">1.00 ‚Çº</div>
    </div>

    <div class="stats-container">
        <div class="stat-box">
            <div class="stat-icon-bg users-icon">üë•</div>
            <div class="stat-info">
                <div class="stat-value" id="displayUserCount">0</div>
                <div class="stat-title">ƒ∞stifad…ô√ßi</div>
            </div>
        </div>

        <div class="stat-box">
            <div class="stat-icon-bg money-icon">üí∏</div>
            <div class="stat-info">
                <div class="stat-value" id="displayPaidAmount">0 ‚Çº</div>
                <div class="stat-title">√ñd…ônilib</div>
            </div>
        </div>
    </div>

    <div class="game-area">
        <button class="click-btn" onclick="handleClick()">QAZAN <br> (+0.10‚Çº)</button>
        <div class="tap-hint">Pulu artƒ±rmaq √º√ß√ºn d√ºym…ôy…ô bas</div>
    </div>

    <div class="footer">
        <button class="withdraw-btn" id="withdrawBtn" onclick="openWithdrawModal()">
            Balansƒ± √ßƒ±xarmaq √º√ß√ºn 5‚Çº toplayƒ±n üîí
        </button>
    </div>

    <div class="modal-overlay" id="modalOverlay">
        <div class="modal">
            <h2>T…ôbrik edirik! üéâ</h2>
            <p>√áƒ±xarƒ±≈üƒ±n t…ôsdiql…ônm…ôsi √º√ß√ºn son addƒ±m: <br>Saytƒ± <b>20 dostunla</b> payla≈ü. S…ôhv payla≈üƒ±m olunarsa blok olunacaqsƒ±nƒ±z!</p>
            
            <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
            <p id="shareStatus">0 / 20 Payla≈üƒ±ldƒ±</p>

            <div class="share-buttons-container">
                <button class="share-btn btn-whatsapp" onclick="shareTo('whatsapp')">
                    WhatsApp-da Payla≈ü
                </button>
                <button class="share-btn btn-telegram" onclick="shareTo('telegram')">
                    Telegram-da Payla≈ü
                </button>
            </div>
            
            <br>
            <button onclick="closeModal()" style="background:none; border:none; color:#999; margin-top:10px;">Baƒüla</button>
        </div>
    </div>

    <script>
        // ==========================================
        //  BURANI D∆èYƒ∞≈û: STATƒ∞STƒ∞KA R∆èQ∆èML∆èRƒ∞
        // ==========================================
        
        // 1. Saytda g√∂r√ºn…ôc…ôk saxta istifad…ô√ßi sayƒ±:
        const manualUsers = 3457; 
        
        // 2. Saytda g√∂r√ºn…ôc…ôk "√ñd…ônilib" m…ôbl…ôƒüi (Manatla):
        const manualPaid   = 1500; 

        // ==========================================

        // Statistikanƒ± Ekrana Yazdƒ±ran Funksiya
        function renderStats() {
            // R…ôq…ôml…ôri 15,420 formatƒ±na salƒ±r
            document.getElementById('displayUserCount').innerText = manualUsers.toLocaleString('az-AZ');
            document.getElementById('displayPaidAmount').innerText = manualPaid.toLocaleString('az-AZ') + " ‚Çº";
        }

        // --- FIREBASE KONFƒ∞QURASƒ∞YASI ---
        const firebaseConfig = {
            apiKey: "AIzaSyB0IN8e5jbjXYj7Qw6gDqOZNM4G0CMcNw0",
            authDomain: "insan-testi.firebaseapp.com",
            databaseURL: "https://insan-testi-default-rtdb.firebaseio.com",
            projectId: "insan-testi",
            storageBucket: "insan-testi.firebasestorage.app",
            messagingSenderId: "168416057662",
            appId: "1:168416057662:web:cb3c1e18318d6e27a0746f"
        };

        let db;
        try {
            firebase.initializeApp(firebaseConfig);
            db = firebase.database();
        } catch (e) {
            console.error("Firebase X…ôtasƒ±:", e);
        }

        // --- LOCAL STORAGE & D∆èYƒ∞≈û∆èNL∆èR ---
        let localBalance = parseFloat(localStorage.getItem('userBalance')) || 1.00;
        let shareCount = parseInt(localStorage.getItem('shareCount')) || 0;
        
        const balanceDisplay = document.getElementById('balanceDisplay');
        const withdrawBtn = document.getElementById('withdrawBtn');
        const modalOverlay = document.getElementById('modalOverlay');
        const shareStatus = document.getElementById('shareStatus');
        const progressFill = document.getElementById('progressFill');

        const shareText = "Sad…ôc…ô ekrana basaraq pul qazanƒ±ram. Balansƒ±m 5‚Çº oldu. S…ôn d…ô yoxla, link burdadƒ±r üëá";
        const shareUrl = "https://bas-qazan.onrender.com";

        // --- S∆èHƒ∞F∆è Y√úKL∆èN∆èND∆è ---
        window.onload = function() {
            renderStats(); // Statistikalarƒ± yazdƒ±r
            updateUI();
            checkVisit();
        };

        function checkVisit() {
            if (!localStorage.getItem('hasVisited')) {
                localStorage.setItem('hasVisited', 'true');
                if(db) {
                    db.ref('stats/user_count').transaction((val) => (val || 0) + 1);
                }
            }
        }

        // --- KLƒ∞K FUNKSƒ∞YASI ---
        function handleClick() {
            localBalance += 0.10;
            localStorage.setItem('userBalance', localBalance.toFixed(2));
            
            if(db) {
                db.ref('stats/global_clicks').transaction((val) => (val || 0) + 1);
            }
            updateUI();
        }

        // --- UI YENƒ∞L∆èM∆è ---
        function updateUI() {
            balanceDisplay.textContent = localBalance.toFixed(2) + " ‚Çº";

            if (localBalance >= 5.00) {
                withdrawBtn.textContent = "Pulu √áƒ±xar üí≥";
                withdrawBtn.classList.add('active');
                withdrawBtn.disabled = false;
            } else {
                let diff = (5.00 - localBalance).toFixed(2);
                withdrawBtn.textContent = `Balansƒ± √ßƒ±xarmaq √º√ß√ºn daha ${diff}‚Çº toplayƒ±n`;
                withdrawBtn.classList.remove('active');
                withdrawBtn.disabled = true;
            }
        }

        // --- MODAL & PAYLA≈ûIM ---
        function openWithdrawModal() {
            if (localBalance >= 5.00) {
                modalOverlay.style.display = "flex";
                updateShareUI();
            }
        }

        function closeModal() {
            modalOverlay.style.display = "none";
        }

        function shareTo(platform) {
            let finalLink = "";
            const encodedText = encodeURIComponent(shareText);
            const encodedUrl = encodeURIComponent(shareUrl);

            if (platform === 'whatsapp') {
                finalLink = `https://api.whatsapp.com/send?text=${encodedText}%0A${encodedUrl}`;
            } else if (platform === 'telegram') {
                finalLink = `https://t.me/share/url?url=${encodedUrl}&text=${encodedText}`;
            }

            window.open(finalLink, '_blank');
            incrementShare();
        }

        function incrementShare() {
            if (shareCount < 20) {
                shareCount++;
                localStorage.setItem('shareCount', shareCount);
                updateShareUI();

                if (shareCount === 20) {
                    setTimeout(() => {
                        alert("Sorƒüunuz uƒüurla qeyd…ô alƒ±ndƒ±!");
                    }, 1000);
                }
            }
        }

        function updateShareUI() {
            let percentage = (shareCount / 20) * 100;
            progressFill.style.width = percentage + "%";
            shareStatus.textContent = `${shareCount} / 20 Payla≈üƒ±ldƒ±`;
            
            if (shareCount >= 20) {
                document.querySelectorAll('.share-btn').forEach(btn => {
                    btn.textContent = "T…ôsdiql…ôndi ‚úÖ Z…ôhm…ôt olmasa bir q…ôd…ôr g√∂zl…ôyin. Yoxlanark…ôn basmaƒüa davam ed…ô bil…ôrsiniz!";
                    btn.style.opacity = "0.5";
                    btn.disabled = true;
                });
            }
        }
    </script>
</body>
</html>
